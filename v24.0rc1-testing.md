[Testing guide](https://github.com/bitcoin-core/bitcoin-devwiki/wiki/24.0-Release-Candidate-Testing-Guide)

[Place to file feedback on testing guide](https://github.com/kouloumos/rc24-guide-feedback-repo)

[Umbrella issue for v24.0 testing](https://github.com/bitcoin/bitcoin/issues/26175)

## General notes

Environment: Ubuntu 22.04 LTS, compiled from source

`./configure --with-gui=yes --with-sqlite=yes BDB_LIBS="-L${BDB_PREFIX}/lib -ldb_cxx-4.8" BDB_CFLAGS="-I${BDB_PREFIX}/include"`

Add `prune=550` to bitcoin.conf if disk space is low.

## ✔️ Observing the new headers pre-synchronization phase during IBD

**Chain**: Mainnet

**Logs for headers pre-sync**

```
2022-09-28T15:57:43Z [net] Initial headers sync started with peer=0: height=0, max_commitments=4452548, min_work=00000000000000000000000000000000000000003404ba0801921119f903495e
2022-09-28T15:57:43Z [net] sending getheaders (101 bytes) peer=0
2022-09-28T15:57:43Z [net] more getheaders (from 00000000dfd5d65c9d8561b4b8f60a63018fe3933ecb131fb37f905f87da951a) to peer=0
2022-09-28T15:57:43Z Pre-synchronizing blockheaders, height: 2000 (~0.28%)
[...]
2022-09-28T15:58:50Z Pre-synchronizing blockheaders, height: 738000 (~97.62%)
[...]
2022-09-28T15:58:51Z [net] Initial headers sync transition with peer=8: reached sufficient work at height=752000, redownloading from height=0
```

✔️ Logs match what the testing guide expects

**Logs for headers sync**

```
2022-09-28T15:58:51Z [net] Initial headers sync transition with peer=8: reached sufficient work at height=752000, redownloading from height=0
2022-09-28T15:58:51Z [net] sending getheaders (101 bytes) peer=8
2022-09-28T15:58:51Z [net] more getheaders (from 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f) to peer=8
2022-09-28T15:58:51Z [net] received: headers (162003 bytes) peer=8
[...]
2022-09-28T15:58:51Z Synchronizing blockheaders, height: 4041 (~0.56%)
[...]
2022-09-28T15:59:05Z [net] Initial headers sync complete with peer=8: releasing all at height=752000 (redownload phase)
2022-09-28T15:59:05Z Synchronizing blockheaders, height: 752000 (~99.46%)
```

✔️ Logs match what the testing guide expects

**Watching the getpeerinfo output**

TODO: insert screenshot of command result

✔️ As expected, the presynced_headers field is set for the peer currently involved in the presync/sync phase (instead of -1)

Observe Further: The peer I was syncing with did not disconnect, and no new blocks came in during headers pre-sync/sync. As a result, I did not observe any of the less common scenarios described in the guide.

TODO: Sync the full blockchain for mainnet

## ✔️ Testing transient addresses for I2P outbound connections

Used official I2P router from https://geti2p.net/en/download 

To run: `~/i2p/i2prouter start`

Tip: to enable SAM, go to http://127.0.0.1:7657/configclients

**Accepting incoming connections**

`bitcoind -i2pacceptincoming=1`

```
cli getpeerinfo | jq 'map(select(.network == "i2p" and .inbound == false)) | map({addrbind: .addrbind})'
[
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  }
]
```

✔️ I2P address is the same for all outgoing connections

**Not accepting incoming connections**

`bitcoind -i2pacceptincoming=0`

```
cli getpeerinfo | jq 'map(select(.network == "i2p" and .inbound == false)) | map({addrbind: .addrbind})'
[
  {
    "addrbind": "qtmvnqodarfi5c4qlm2y2kga7aefz5y42k3svpbqnaclxyfaswqq.b32.i2p:0"
  },
  {
    "addrbind": "mgo3mkxa3dtgaaobn5vh6boqgwe6rpegrrsxqryxuhqcdg7yio2a.b32.i2p:0"
  },
  {
    "addrbind": "aeb43hzl6vrma5nu6obtanousnzirceva3b3w2xwuht7so7cfoza.b32.i2p:0"
  },
  {
    "addrbind": "2fpnc3wviya4cqxxs7egj5rvaepaloujitcod4qjtmueh5datrba.b32.i2p:0"
  },
  {
    "addrbind": "7kbarnrexsw7e7xzopye72fionp72fubhmhhkaurnjh5x5gpzlza.b32.i2p:0"
  },
  {
    "addrbind": "oriaauihkownt6rvprsvg56xwprdoky57rbyidqnkrd24qqbd6fq.b32.i2p:0"
  },
  {
    "addrbind": "r73a53fcfa7q5u2yrouy2pzonduxew2kesq2kgsppuggxijbdoha.b32.i2p:0"
  },
  {
    "addrbind": "vrtm43hleoh5uwesw4a4nakxqnjmdahqlnnwnrw4sn6ddtl7yhxq.b32.i2p:0"
  },
  {
    "addrbind": "rkteucyzgfnz73jc7jwflyujx5whgat4yc6p6y45yykcgy3334sq.b32.i2p:0"
  },
  {
    "addrbind": "mpd2uks4vtxlumecg4vrvam77wtf5gx34svgdmnru3u6bnwozntq.b32.i2p:0"
  }
]
```

✔️ I2P address is different for each outgoing connection

## Migrating legacy wallets to descriptor wallets - ATTEMPT #1
- solvable: anything we have any (public) keys for and know how to spend 

```
wallet getaddressinfo $legacy
{
  "address": "1BZwUQ7zLZkfS8CPUWfM5UikL17cvksRRd",
  "scriptPubKey": "76a91473ec0a3557513562d0d03e6d5360a17c7992af2388ac",
  "ismine": true,
  "solvable": true,
  "desc": "pkh([232fe3d1/0'/0'/0']03edd5022971cc53f8c61b2a524a4562a89615c80422d9878218efd0d8772bab11)#kpradp2r",
  "iswatchonly": false,
  "isscript": false,
  "iswitness": false,
  "pubkey": "03edd5022971cc53f8c61b2a524a4562a89615c80422d9878218efd0d8772bab11",
  "iscompressed": true,
  "ischange": false,
  "timestamp": 1664415031,
  "hdkeypath": "m/0'/0'/0'",
  "hdseedid": "87abba25164f7bf0e8a99eb5f1513d69bfc3612c",
  "hdmasterfingerprint": "232fe3d1",
  "labels": [
    "my-P2PKH"
  ]
}
```
✔️ `isMine = true`, `solvable = true`, `iswatchonly = false`, `labels = my-P2PKH`


```
wallet getaddressinfo $p2sh_segwit
{
  "address": "3FQMBkphtNXt5FqnHePoPDm6tQtwkpfT3C",
  "scriptPubKey": "a914966ac4db30b5adf0520a09c5aab16d4dab48926f87",
  "ismine": true,
  "solvable": true,
  "desc": "sh(wpkh([232fe3d1/0'/0'/1']039b58a1c0020caed22a04aaaa7bd976830cf9746a3167eaa7786dc391731ebe1c))#gzpgpzpd",
  "iswatchonly": false,
  "isscript": true,
  "iswitness": false,
  "script": "witness_v0_keyhash",
  "hex": "00141f035de8556eeb2cbe05c70e036a944da6abe7fd",
  "pubkey": "039b58a1c0020caed22a04aaaa7bd976830cf9746a3167eaa7786dc391731ebe1c",
  "embedded": {
    "isscript": false,
    "iswitness": true,
    "witness_version": 0,
    "witness_program": "1f035de8556eeb2cbe05c70e036a944da6abe7fd",
    "pubkey": "039b58a1c0020caed22a04aaaa7bd976830cf9746a3167eaa7786dc391731ebe1c",
    "address": "bc1qrup4m6z4dm4je0s9cu8qx655fkn2helay2f7ag",
    "scriptPubKey": "00141f035de8556eeb2cbe05c70e036a944da6abe7fd"
  },
  "ischange": false,
  "timestamp": 1664415031,
  "hdkeypath": "m/0'/0'/1'",
  "hdseedid": "87abba25164f7bf0e8a99eb5f1513d69bfc3612c",
  "hdmasterfingerprint": "232fe3d1",
  "labels": [
    "my-P2SH(P2WPKH)"
  ]
}
```
✔️ `isMine = true`, `solvable = true`, `iswatchonly = false`, `labels = my-P2SH(P2WPKH)`

```
wallet getaddressinfo $bech32
{
  "address": "bc1qcx5udjh803fzm7jt5e3lj03qu9chzrrdxjq92k",
  "scriptPubKey": "0014c1a9c6cae77c522dfa4ba663f93e20e171710c6d",
  "ismine": true,
  "solvable": true,
  "desc": "wpkh([232fe3d1/0'/0'/2']0294b216f1a20fe6d3f50726efaf1bc57e144c710e88a06b988da435dc2dfabd69)#46774kk8",
  "iswatchonly": false,
  "isscript": false,
  "iswitness": true,
  "witness_version": 0,
  "witness_program": "c1a9c6cae77c522dfa4ba663f93e20e171710c6d",
  "pubkey": "0294b216f1a20fe6d3f50726efaf1bc57e144c710e88a06b988da435dc2dfabd69",
  "ischange": false,
  "timestamp": 1664415031,
  "hdkeypath": "m/0'/0'/2'",
  "hdseedid": "87abba25164f7bf0e8a99eb5f1513d69bfc3612c",
  "hdmasterfingerprint": "232fe3d1",
  "labels": [
    "my-P2WPKH"
  ]
}
```
✔️ `isMine = true`, `solvable = true`, `iswatchonly = false`, `labels = my-P2WPKH`

```
wallet getaddressinfo $non_HD_address
{
  "address": "bc1qthfgts22xtrdq3jxt3qklhuvn0ylururasqtl2",
  "scriptPubKey": "00145dd285c14a32c6d046465c416fdf8c9bc9fe0f83",
  "ismine": true,
  "solvable": true,
  "desc": "wpkh([5dd285c1]03b205877eb552f17aa9fcac57935ac258b6b5b69d401303618756dc8859c48d49)#62xwkvj0",
  "iswatchonly": false,
  "isscript": false,
  "iswitness": true,
  "witness_version": 0,
  "witness_program": "5dd285c14a32c6d046465c416fdf8c9bc9fe0f83",
  "pubkey": "03b205877eb552f17aa9fcac57935ac258b6b5b69d401303618756dc8859c48d49",
  "ischange": false,
  "timestamp": 1,
  "labels": [
    "non-HD"
  ]
}
```
✔️ `isMine = true` because the non_hd_key was imported into the wallet, `solvable = true`, `iswatchonly = false`, `labels = non-HD`


```
wallet getaddressinfo $watch_address
{
  "address": "bc1q5kynasa6xppczjp9y94gmwdtcse2u75zrzu8fe",
  "scriptPubKey": "0014a5893ec3ba3043814825216a8db9abc432ae7a82",
  "ismine": false,
  "solvable": false,
  "iswatchonly": true,
  "isscript": false,
  "iswitness": true,
  "witness_version": 0,
  "witness_program": "a5893ec3ba3043814825216a8db9abc432ae7a82",
  "ischange": false,
  "timestamp": 1,
  "labels": [
    "watch-me"
  ]
}
```
✔️ `isMine = false`, `solvable = false` because we don't have the key(s) for this imported watch address, `iswatchonly = true`, `labels = watch-me`


```
wallet getaddressinfo $multisig_address
{
  "address": "bc1q78zmnc4cgurv2vkmk8ea0rd4mpntj6kwmxgana0jaa7g9hvme40saqxm87",
  "scriptPubKey": "0020f1c5b9e2b84706c532dbb1f3d78db5d866b96aced991d9f5f2ef7c82dd9bcd5f",
  "ismine": false,
  "solvable": true,
  "desc": "wsh(multi(1,[232fe3d1/0'/0'/3']03295669b44d7b94f505237d6d82e0187a57c9a2f69a72eaf8a4329a9f1437b205,02f9703ff1c034ffd94be97dc6aa23bbda265ad7ddc5a068090bfe1f32bfcbe416))#x8v4az6a",
  "iswatchonly": false,
  "isscript": true,
  "iswitness": true,
  "witness_version": 0,
  "witness_program": "f1c5b9e2b84706c532dbb1f3d78db5d866b96aced991d9f5f2ef7c82dd9bcd5f",
  "script": "multisig",
  "hex": "512103295669b44d7b94f505237d6d82e0187a57c9a2f69a72eaf8a4329a9f1437b2052102f9703ff1c034ffd94be97dc6aa23bbda265ad7ddc5a068090bfe1f32bfcbe41652ae",
  "sigsrequired": 1,
  "pubkeys": [
    "03295669b44d7b94f505237d6d82e0187a57c9a2f69a72eaf8a4329a9f1437b205",
    "02f9703ff1c034ffd94be97dc6aa23bbda265ad7ddc5a068090bfe1f32bfcbe416"
  ],
  "ischange": false,
  "labels": [
    "multisig"
  ]
}
```
✔️ `isMine = false`, `solvable = true`, `iswatchonly = false`, `labels = multisig`


**Migration result**

```
wallet migratewallet
{
  "wallet_name": "legacy",
  "watchonly_name": "legacy_watchonly",
  "solvables_name": "legacy_solvables",
  "backup_path": "/tmp/24-rc-test/legacy/legacy-1664417457.legacy.bak"
}
```
✔️ Migration had no errors and was a success 

**Verifying the 12 descriptors**

✖️ Note: had to load the wallet to view the descriptors
```
cli -rpcwallet=legacy_watchonly listdescriptors

{
  "wallet_name": "legacy",
  "descriptors": [
    {
      "desc": "combo([2c61c3bf]02380e1270bd89ceaffd929f37e5bb1ce26247997242d2b2c77f89dd2f88ffb9ea)#m9jxgph2",
      "timestamp": 1664415031,
      "active": false
    },
    {
      "desc": "combo([5dd285c1]03b205877eb552f17aa9fcac57935ac258b6b5b69d401303618756dc8859c48d49)#cd7kpxff",
      "timestamp": 1,
      "active": false
    },
    {
      "desc": "combo(xpub661MyMwAqRbcEi9K2dYF9BK9KyDVbV856n2k8izEzMxjeWKAwMywgwkedME6iHr7QjAQL6M5ugFhsGmETGrVbi7cNwdFUAC4MTCQ2rNTd6h/0'/0'/*')#qvnqd82f",
      "timestamp": 0,
      "active": false,
      "range": [
        0,
        1003
      ],
      "next": 0
    },
    {
      "desc": "combo(xpub661MyMwAqRbcEi9K2dYF9BK9KyDVbV856n2k8izEzMxjeWKAwMywgwkedME6iHr7QjAQL6M5ugFhsGmETGrVbi7cNwdFUAC4MTCQ2rNTd6h/0'/1'/*')#s2e3ahls",
      "timestamp": 0,
      "active": false,
      "range": [
        0,
        999
      ],
      "next": 0
    },
    {
      "desc": "pkh([232fe3d1/44'/0'/0']xpub6CUaL1ESk2hCz3BZom717y3aA8CLNEoYA4vcToY6fJHkCDXLJzbJA5NwPZjCQEjL2g6jLKUJojKgtjpLhD6NqSFHnGJ5DdgMBMRf7TC2PaG/0/*)#2xyeklcl",
      "timestamp": 1664417581,
      "active": true,
      "internal": false,
      "range": [
        0,
        999
      ],
      "next": 0
    },
    {
      "desc": "pkh([232fe3d1/44'/0'/0']xpub6CUaL1ESk2hCz3BZom717y3aA8CLNEoYA4vcToY6fJHkCDXLJzbJA5NwPZjCQEjL2g6jLKUJojKgtjpLhD6NqSFHnGJ5DdgMBMRf7TC2PaG/1/*)#mjpct2g8",
      "timestamp": 1664417582,
      "active": true,
      "internal": true,
      "range": [
        0,
        999
      ],
      "next": 0
    },
    {
      "desc": "sh(wpkh([232fe3d1/49'/0'/0']xpub6CohGCzo7oM9rbkCwWCZuTVsaYeBrQnU6z8WPvqF4Kuz948gwMgamNyAdK3RUhHSDMNYaac6unZuS4tB5LzecnYpYtrJTX7UxZ34sHagzAQ/0/*))#9998le9p",
      "timestamp": 1664417581,
      "active": true,
      "internal": false,
      "range": [
        0,
        999
      ],
      "next": 0
    },
    {
      "desc": "sh(wpkh([232fe3d1/49'/0'/0']xpub6CohGCzo7oM9rbkCwWCZuTVsaYeBrQnU6z8WPvqF4Kuz948gwMgamNyAdK3RUhHSDMNYaac6unZuS4tB5LzecnYpYtrJTX7UxZ34sHagzAQ/1/*))#syt38xs7",
      "timestamp": 1664417582,
      "active": true,
      "internal": true,
      "range": [
        0,
        999
      ],
      "next": 0
    },
    {
      "desc": "tr([232fe3d1/86'/0'/0']xpub6DUwXqs7MQsBxcZ3974ZVT5YF64yQGqgs4ztVJKvce7T8GzkDBqULu2cqPkpRP1gNsitpyoFznXTQFz3oP4mjY4tMKmsYTaw7V2232qwPoQ/0/*)#n6r4q5pa",
      "timestamp": 1664417582,
      "active": true,
      "internal": false,
      "range": [
        0,
        999
      ],
      "next": 0
    },
    {
      "desc": "tr([232fe3d1/86'/0'/0']xpub6DUwXqs7MQsBxcZ3974ZVT5YF64yQGqgs4ztVJKvce7T8GzkDBqULu2cqPkpRP1gNsitpyoFznXTQFz3oP4mjY4tMKmsYTaw7V2232qwPoQ/1/*)#zwx5ap39",
      "timestamp": 1664417582,
      "active": true,
      "internal": true,
      "range": [
        0,
        999
      ],
      "next": 0
    },
    {
      "desc": "wpkh([232fe3d1/84'/0'/0']xpub6BhhETR6yf7cmTBQXB29NeFsBEdTcVNeJSG4uDJoZD6i5G9MvxyF6Saq71Nr9FR5rcdmT3PHmWSn5DmGjJb6rYvmWDazK5YQ6xDYrBGfkmk/0/*)#us5qy5yp",
      "timestamp": 1664417581,
      "active": true,
      "internal": false,
      "range": [
        0,
        999
      ],
      "next": 0
    },
    {
      "desc": "wpkh([232fe3d1/84'/0'/0']xpub6BhhETR6yf7cmTBQXB29NeFsBEdTcVNeJSG4uDJoZD6i5G9MvxyF6Saq71Nr9FR5rcdmT3PHmWSn5DmGjJb6rYvmWDazK5YQ6xDYrBGfkmk/1/*)#dy3pep5e",
      "timestamp": 1664417582,
      "active": true,
      "internal": true,
      "range": [
        0,
        999
      ],
      "next": 0
    }
  ]
}
```
✔️ 2 descriptors per script type (pkh, sh(wpkh), tr, wpkh), accounting for 8 of the descriptors
✔️ range combo descriptor for external addresses: `combo(<xpub>/0'/0'/*')#qvnqd82f`
✔️ range combo descriptor for internal addresses: `combo(<xpub>/0'/1'/*')#s2e3ahls`
✖️ ? 2 combo descriptors for the hd seed? Should be one.

✔️ 1 descriptor for the `legacy_watchonly` wallet, confirmed that the `watch_address` belongs to this wallet
```
cli -rpcwallet=legacy_watchonly listdescriptors
{
  "wallet_name": "legacy_watchonly",
  "descriptors": [
    {
      "desc": "addr(bc1q5kynasa6xppczjp9y94gmwdtcse2u75zrzu8fe)#auskal8c",
      "timestamp": 1,
      "active": false
    }
  ]
}
```

✔️ 3 descriptors for the `legacy_solvables` wallet, and can observe that the `multisig_address` belongs to this wallet (particularly since only one multisig address was created) 
```
cli -rpcwallet=legacy_solvables listdescriptors
{
  "wallet_name": "legacy_solvables",
  "descriptors": [
    {
      "desc": "sh(multi(1,[232fe3d1/0'/0'/3']03295669b44d7b94f505237d6d82e0187a57c9a2f69a72eaf8a4329a9f1437b205,02f9703ff1c034ffd94be97dc6aa23bbda265ad7ddc5a068090bfe1f32bfcbe416))#5da89v03",
      "timestamp": 0,
      "active": false
    },
    {
      "desc": "sh(wsh(multi(1,[232fe3d1/0'/0'/3']03295669b44d7b94f505237d6d82e0187a57c9a2f69a72eaf8a4329a9f1437b205,02f9703ff1c034ffd94be97dc6aa23bbda265ad7ddc5a068090bfe1f32bfcbe416)))#vvp4seqa",
      "timestamp": 0,
      "active": false
    },
    {
      "desc": "wsh(multi(1,[232fe3d1/0'/0'/3']03295669b44d7b94f505237d6d82e0187a57c9a2f69a72eaf8a4329a9f1437b205,02f9703ff1c034ffd94be97dc6aa23bbda265ad7ddc5a068090bfe1f32bfcbe416))#x8v4az6a",
      "timestamp": 0,
      "active": false
    }
  ]
}
```

## GUI: Testing the restore wallet option

Copied the wallet backup file created during the wallet migration to a different directory and renamed it:
```
cp legacy-1664417457.legacy.bak ~/Desktop
mv ~/Desktop/legacy-1664417457.legacy.bak ~/Desktop/legacy-wallet-backup.dat
```

✖️ The GUI crashes whenever I try to restore. Going to try again with fresh datadir.
