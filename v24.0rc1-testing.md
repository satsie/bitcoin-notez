[Testing guide](https://github.com/bitcoin-core/bitcoin-devwiki/wiki/24.0-Release-Candidate-Testing-Guide)

[Place to file feedback on testing guide](https://github.com/kouloumos/rc24-guide-feedback-repo)

[Umbrella issue for v24.0 testing](https://github.com/bitcoin/bitcoin/issues/26175)

## General notes

Environment: Ubuntu 22.04 LTS, compiled from source

## Observing the new headers pre-synchronization phase during IBD

**Chain**: Mainnet

**Logs for headers pre-sync**

```
2022-09-28T15:57:43Z [net] Initial headers sync started with peer=0: height=0, max_commitments=4452548, min_work=00000000000000000000000000000000000000003404ba0801921119f903495e
2022-09-28T15:57:43Z [net] sending getheaders (101 bytes) peer=0
2022-09-28T15:57:43Z [net] more getheaders (from 00000000dfd5d65c9d8561b4b8f60a63018fe3933ecb131fb37f905f87da951a) to peer=0
2022-09-28T15:57:43Z Pre-synchronizing blockheaders, height: 2000 (~0.28%)
[...]
2022-09-28T15:58:50Z Pre-synchronizing blockheaders, height: 738000 (~97.62%)
[...]
2022-09-28T15:58:51Z [net] Initial headers sync transition with peer=8: reached sufficient work at height=752000, redownloading from height=0
```

✔️ Logs match what the testing guide expects

**Logs for headers sync**

```
2022-09-28T15:58:51Z [net] Initial headers sync transition with peer=8: reached sufficient work at height=752000, redownloading from height=0
2022-09-28T15:58:51Z [net] sending getheaders (101 bytes) peer=8
2022-09-28T15:58:51Z [net] more getheaders (from 000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f) to peer=8
2022-09-28T15:58:51Z [net] received: headers (162003 bytes) peer=8
[...]
2022-09-28T15:58:51Z Synchronizing blockheaders, height: 4041 (~0.56%)
[...]
2022-09-28T15:59:05Z [net] Initial headers sync complete with peer=8: releasing all at height=752000 (redownload phase)
2022-09-28T15:59:05Z Synchronizing blockheaders, height: 752000 (~99.46%)
```

✔️ Logs match what the testing guide expects

**Watching the getpeerinfo output**

TODO: insert screenshot of command result

✔️ As expected, the presynced_headers field is set for the peer currently involved in the presync/sync phase (instead of -1)

Observe Further: The peer I was syncing with did not disconnect, and no new blocks came in during headers pre-sync/sync. As a result, I did not observe any of the less common scenarios described in the guide.

TODO: Sync the full blockchain for mainnet

## Testing transient addresses for I2P outbound connections

Used official I2P router from https://geti2p.net/en/download 

To run: `~/i2p/i2prouter start`

Tip: to enable SAM, go to http://127.0.0.1:7657/configclients

**Accepting incoming connections**

`bitcoind -i2pacceptincoming=1`

```
cli getpeerinfo | jq 'map(select(.network == "i2p" and .inbound == false)) | map({addrbind: .addrbind})'
[
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  },
  {
    "addrbind": "z4n5a4zqohzwqkakyt5j5c6znml7becr4t27cumo4symisgbhwwa.b32.i2p:0"
  }
]
```

✔️ I2P address is the same for all outgoing connections

**Not accepting incoming connections**

`bitcoind -i2pacceptincoming=0`

```
cli getpeerinfo | jq 'map(select(.network == "i2p" and .inbound == false)) | map({addrbind: .addrbind})'
[
  {
    "addrbind": "qtmvnqodarfi5c4qlm2y2kga7aefz5y42k3svpbqnaclxyfaswqq.b32.i2p:0"
  },
  {
    "addrbind": "mgo3mkxa3dtgaaobn5vh6boqgwe6rpegrrsxqryxuhqcdg7yio2a.b32.i2p:0"
  },
  {
    "addrbind": "aeb43hzl6vrma5nu6obtanousnzirceva3b3w2xwuht7so7cfoza.b32.i2p:0"
  },
  {
    "addrbind": "2fpnc3wviya4cqxxs7egj5rvaepaloujitcod4qjtmueh5datrba.b32.i2p:0"
  },
  {
    "addrbind": "7kbarnrexsw7e7xzopye72fionp72fubhmhhkaurnjh5x5gpzlza.b32.i2p:0"
  },
  {
    "addrbind": "oriaauihkownt6rvprsvg56xwprdoky57rbyidqnkrd24qqbd6fq.b32.i2p:0"
  },
  {
    "addrbind": "r73a53fcfa7q5u2yrouy2pzonduxew2kesq2kgsppuggxijbdoha.b32.i2p:0"
  },
  {
    "addrbind": "vrtm43hleoh5uwesw4a4nakxqnjmdahqlnnwnrw4sn6ddtl7yhxq.b32.i2p:0"
  },
  {
    "addrbind": "rkteucyzgfnz73jc7jwflyujx5whgat4yc6p6y45yykcgy3334sq.b32.i2p:0"
  },
  {
    "addrbind": "mpd2uks4vtxlumecg4vrvam77wtf5gx34svgdmnru3u6bnwozntq.b32.i2p:0"
  }
]
```

✔️ I2P address is different for each outgoing connection
